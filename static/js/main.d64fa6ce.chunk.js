(this["webpackJsonpyiara-editor"]=this["webpackJsonpyiara-editor"]||[]).push([[0],{17:function(e,t,i){e.exports=i(27)},22:function(e,t,i){},25:function(e,t,i){},26:function(e){e.exports=JSON.parse('{"res":["img/uq.jpg","img/pokeball.png"],"name":"Cena 01","actors":[{"x":10,"y":10,"width":80,"height":80,"render":{"sprite":{"texture":"img/uq.jpg"}},"act":[["engine","if (engine.pressed.right) this.x++"]]},{"x":100,"y":100,"width":80,"height":80,"frictionAir":0,"render":{"sprite":{"texture":"img/uq.jpg","xScale":0.15,"yScale":0.15}},"physics":{"shape":"rectangle","vertices":["..."]}},{"x":200,"y":100,"radius":30,"density":0.0005,"frictionAir":0,"restitution":0.5,"friction":0.5,"mass":100,"render":{"sprite":{"texture":"img/pokeball.png","xScale":0.4,"yScale":0.4}},"physics":{"shape":"circle","vertices":["..."]}}]}')},27:function(e,t,i){"use strict";i.r(t);var n=i(0),s=i.n(n),r=i(9),a=i.n(r),o=(i(22),i(14)),c=i(1),h=i(2),u=i(16),l=i(15),d=i(5),f=i(4),v=i(10),g=i.n(v),x=function(){function e(t){var i=this;Object(c.a)(this,e);var n="string"===typeof t?document.querySelector(t):t;if(this.ctx=n.getContext("2d"),!n||!this.ctx)throw new Error({Error:"Canvas element not found."});this.actors=[],this.editing=!0,this.dragging=!1,this.mousedown={},this.res={},this.offsetX=0,this.offsetY=0,this.vOffsetX=0,this.vOffsetY=0,this.vMaxOffsetX=20,this.vMaxOffsetY=20,this.anchorX=.5,this.anchorY=.5,this.scale=1,this.minScale=.5,this.maxScale=4,n.addEventListener("mousedown",(function(e){e.preventDefault();var t=i.windowToCanvas(e.clientX,e.clientY),n={x:i.normalizeX(t.x),y:i.normalizeY(t.y)};console.debug("mousedown",t),console.debug("mousedown (normalized)",n),console.debug("normalize debug | offsetX: ".concat(i.offsetX," scale: ").concat(i.scale)),i.selected=null,i.scene.actors.forEach((function(e){y.call(i,t.x,t.y,i.anchor(e))?(i.startDragging(t),i.removeActor(e),i.addActor(e),i.selected=e,i.dragging=e,i.dragOffsetX=i.normalizeX(t.x)-e.x,i.dragOffsetY=i.normalizeY(t.y)-e.y,i.dragCallback=function(e){this.selected.x=this.round(this.normalizeX(e.x)-this.dragOffsetX),this.selected.y=this.round(this.normalizeY(e.y)-this.dragOffsetY)},i.runCycle()):(i.dragging=!0,i.prevLoc=t,i.dragCallback=function(e){var t=(e.x-this.prevLoc.x)/this.scale,i=(e.y-this.prevLoc.y)/this.scale;this.offsetX+=t,this.offsetY+=i,this.prevLoc=e}),i.onSelect&&i.onSelect(i.selected,t)}))})),n.addEventListener("mousemove",(function(e){e.preventDefault();var t=i.windowToCanvas(e.clientX,e.clientY);if(i.editing&&i.dragging)return i.cursor("all-scroll"),i.dragCallback(t),i.runCycle(),void(i.onDrag&&i.onDrag());var n=i.actorsInPoint(t.x,t.y);i.cursor("auto"),n.length>0&&i.cursor("pointer")})),n.addEventListener("mouseup",(function(e){i.dragging=!1})),n.addEventListener("mousewheel",(function(e){e.preventDefault(),e.deltaY>0?i.scale-.1<i.minScale||(i.scale-=.1):i.scale+.1>i.maxScale||(i.scale+=.1),i.runCycle()})),window.addEventListener("mousedown",(function(e){i.canvasFocus=e.target==n})),window.addEventListener("keydown",(function(e){i.canvasFocus&&(i.vOffsetX+=i.vOffsetX<i.vMaxOffsetX?1:0,i.selected?37===e.keyCode?i.selected.x-=i.vOffsetX:39===e.keyCode&&(i.selected.x+=i.vOffsetX):37===e.keyCode?i.offsetX-=i.vOffsetX:39===e.keyCode&&(i.offsetX+=i.vOffsetX),i.runCycle(),i.onDrag&&i.onDrag())})),window.addEventListener("keyup",(function(e){i.canvasFocus&&(i.vOffsetX=i.vOffsetY=0)}))}return Object(h.a)(e,[{key:"cursor",value:function(e){var t=this.ctx.canvas.style;return e?t.cursor=e:t.cursor}},{key:"setState",value:function(e){this.state=e}},{key:"isState",value:function(e){return this.state===e}},{key:"drawGrid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lightgrey",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;this.ctx.save(),this.ctx.strokeStyle=e,this.ctx.lineWidth=.5;for(var n=this.width/this.scale,s=this.height/this.scale,r=this.offsetX%t,a=this.offsetY%i,o=r+.5;o<n;o+=t)this.ctx.beginPath(),this.ctx.moveTo(o-this.offsetX,0-this.offsetY),this.ctx.lineTo(o-this.offsetX,s-this.offsetY),this.ctx.stroke();for(var c=a+.5;c<s;c+=i)this.ctx.beginPath(),this.ctx.moveTo(0-this.offsetX,c-this.offsetY),this.ctx.lineTo(n-this.offsetX,c-this.offsetY),this.ctx.stroke();this.ctx.restore()}},{key:"clearCanvas",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"startDragging",value:function(e){this.mousedown.x=e.x,this.mousedown.y=e.y}},{key:"windowToCanvas",value:function(e,t){var i=this.ctx.canvas,n=i.getBoundingClientRect();return{x:e-n.left*(i.width/n.width),y:t-n.top*(i.height/n.height)}}},{key:"drawHorizontalLine",value:function(e){this.ctx.beginPath(),this.ctx.moveTo(0-this.offsetX,e+.5),this.ctx.lineTo(0-this.offsetX+this.width/this.scale,e+.5),this.ctx.stroke()}},{key:"drawVerticalLine",value:function(e){this.ctx.beginPath(),this.ctx.moveTo(e+.5,0-this.offsetY),this.ctx.lineTo(e+.5,0-this.offsetY+this.height/this.scale),this.ctx.stroke()}},{key:"drawGuidewires",value:function(e,t){this.ctx.save(),this.ctx.strokeStyle="rgba(0,0,230,0.4)",this.ctx.lineWidth=.5,this.drawVerticalLine(e),this.drawHorizontalLine(t),this.ctx.restore()}},{key:"removeActor",value:function(e){var t=this.scene.actors.indexOf(e);-1!=t&&this.scene.actors.splice(t,1)}},{key:"addActor",value:function(e){this.scene.actors.push(e)}},{key:"drawActor",value:function(e){var t=this.res[e.render.sprite.texture];e=this.anchor(e),this.ctx.drawImage(t,e.x,e.y,e.width||2*e.radius,e.height||2*e.radius)}},{key:"drawActors",value:function(){var e=this;this.scene.actors.forEach((function(t){e.drawActor(t)}))}},{key:"drawBorder",value:function(e,t,i,n){this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.rect(e-1,t-1,i+2,n+2),this.ctx.stroke(),this.ctx.restore()}},{key:"runCycle",value:function(){if(this.clearCanvas(),this.ctx.save(),this.ctx.scale(this.scale,this.scale),this.ctx.translate(this.offsetX,this.offsetY),this.drawGrid("lightgray",25,25),this.drawActors(),this.selected){var e=this.anchor(this.selected);this.drawBorder(e.x,e.y,e.width||2*e.radius,e.height||2*e.radius),this.drawGuidewires(e.x+(e.width/2||e.radius),e.y+(e.height/2||e.radius))}this.ctx.restore()}},{key:"createImage",value:function(e,t,i){var n=new Image;return n.src=n.fileName=e,n.addEventListener("load",t),n.addEventListener("error",i),n}},{key:"loadResources",value:function(e){var t=this,i=this.scene.res;i.forEach((function(e){t.res[e]=t.createImage(e,(function(e){i.indexOf(e.path[0].fileName)==i.length-1&&t.runCycle()}))}))}},{key:"actorsInPoint",value:function(e,t){var i=this;return this.scene.actors.filter((function(n){return y.call(i,e,t,i.anchor(n))}))}},{key:"loadScene",value:function(e){this.scene=e,this.loadResources(),this.runCycle()}},{key:"anchor",value:function(e){var t=Object.create(e);return t.x=e.x-(e.width||2*e.radius)*this.anchorX,t.y=e.y-(e.height||2*e.radius)*this.anchorY,e.radius,t}},{key:"normalizeX",value:function(e){return(e-this.offsetX)/this.scale}},{key:"normalizeY",value:function(e){return(e-this.offsetY)/this.scale}},{key:"round",value:function(e){return+(Math.round(2*e)/2).toFixed(1)}},{key:"width",get:function(){return this.ctx.canvas.width}},{key:"height",get:function(){return this.ctx.canvas.height}}]),e}();function y(e,t,i){return e=e/this.scale-this.offsetX,t=t/this.scale-this.offsetY,i.radius?function(e,t,i){return!!i.radius&&w(e-(i.x+i.radius))+w(t-(i.y+i.radius))<=w(i.radius)}(e,t,i):i.width&&i.height?function(e,t,i){return!(!i.width&&!i.height)&&(!(e<i.x||e>i.x+i.width)&&!(t<i.y||t>i.y+i.height))}(e,t,i):void 0}function w(e){return Math.pow(e,2)}function p(){var e=Object(d.a)(["\n  position: relative;\n  width: 600px;\n  height: 400px;\n\n  > * {\n    position: absolute;\n    top: 0;\n    left: 0;\n  }\n"]);return p=function(){return e},e}function m(){var e=Object(d.a)(["\n  width: 600px;\n  height: 400px;\n  visibility: hidden;\n  overflow: hidden;\n"]);return m=function(){return e},e}var k=f.a.div({height:400,width:600,margin:20,textAlign:"center",display:"inline-block"}),X=f.a.div(m()),C=f.a.div(p()),b=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(){var e;return Object(c.a)(this,i),(e=t.call(this)).state={running:!1},e}return Object(h.a)(i,[{key:"setupCanvas",value:function(e){if(!e)return null;var t=this.directorInstance=new x(e),i=this.getCurrentScene();t.loadScene(i),t.onSelect=function(e){console.log(e)},t.onDrag=function(){}}},{key:"setupPreview",value:function(e){this.previewRef=e}},{key:"getCurrentScene",value:function(){var e=this.props.scenes;return e.data[e.selectedIndex]}},{key:"preview",value:function(){var e=this.state.running,t=this.previewRef,i=!e;if(t.style.visibility=i?"unset":"hidden",i){var n=this.getCurrentScene(),s=new g.a(n,this.previewRef);s.addMouseConstraint(),s.run()}else t.removeChild(t.children[0]);this.setState({running:i})}},{key:"shouldComponentUpdate",value:function(e){return this.props.running!==e.running&&this.preview(),!1}},{key:"render",value:function(){var e=this,t=this.state.running;return s.a.createElement(k,null,s.a.createElement(C,{running:t},s.a.createElement("canvas",{width:"600",height:"400",ref:function(t){return e.setupCanvas(t)}},"no support"),s.a.createElement(X,{ref:function(t){return e.setupPreview(t)}})))}}]),i}(s.a.Component),O=(i(25),i(26));var S=function(){var e=s.a.useState(!1),t=Object(o.a)(e,2),i=t[0],n=t[1];return s.a.createElement("div",{className:"App"},s.a.createElement(b,{scenes:{data:[O],selectedIndex:0},running:i}),s.a.createElement("div",null,s.a.createElement("button",{onClick:function(){return n(!i)}},i?"Stop":"Run")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[17,1,2]]]);
//# sourceMappingURL=main.d64fa6ce.chunk.js.map